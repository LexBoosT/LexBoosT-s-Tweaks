Add-Type -AssemblyName System.Windows.Forms
# Vérifier les privilèges administratifs
function Check-Admin {
    Write-Host "Checking for Administrative Privileges..."
    Start-Sleep -Seconds 3

    $currentUser = [Security.Principal.WindowsIdentity]::GetCurrent()
    $principal = New-Object Security.Principal.WindowsPrincipal($currentUser)
    if (-not $principal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
        Start-Process powershell -Verb runAs -ArgumentList "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`""
        exit
    }
}
Check-Admin


function Show-Menu {
    do {
        Clear-Host
        Write-Host "============================================="
        Write-Host "|        LexBoosT DPI Scaling Fixer         |" -ForegroundColor Magenta
        Write-Host "============================================="
        Write-Host "|         Based on MarkC Mouse Fix          |" -ForegroundColor Magenta
        Write-Host "============================================="
        Write-Host "| 1. Set scaling to 100%                    |" -ForegroundColor Green
        Write-Host "| 2. Set scaling to 125%                    |" -ForegroundColor Yellow
        Write-Host "| 3. Set scaling to 150%                    |" -ForegroundColor Green
        Write-Host "| 4. Set scaling to 175%                    |" -ForegroundColor Yellow
        Write-Host "| 5. Set scaling to 200%                    |" -ForegroundColor Green
        Write-Host "| 6. Set scaling to 225%                    |" -ForegroundColor Yellow
        Write-Host "| 7. Set scaling to 250%                    |" -ForegroundColor Green
        Write-Host "| 8. Set scaling to 300%                    |" -ForegroundColor Yellow
        Write-Host "| 9. Set scaling to 350%                    |" -ForegroundColor Green
		Write-Host "| 10. Automatic Scaling                     |" -ForegroundColor Blue
        Write-Host "| 0. Exit                                   |" -ForegroundColor Red
        Write-Host "============================================="

        $choice = Read-Host "Enter your choice"
        switch ($choice) {
            1 { Set-Scaling "100%" }
            2 { Set-Scaling "125%" }
            3 { Set-Scaling "150%" }
            4 { Set-Scaling "175%" }
            5 { Set-Scaling "200%" }
            6 { Set-Scaling "225%" }
            7 { Set-Scaling "250%" }
            8 { Set-Scaling "300%" }
            9 { Set-Scaling "350%" }
			10{ Auto-SetScaling }
            0 { Write-Host "Goodbye!..." -ForegroundColor Red
			Start-Sleep -Seconds 2
            exit
        }
            default { Write-Host "Invalid choice, please try again." }
        }
    } while ($choice -ne 10)
}

function Set-Scaling {
    param (
        [string]$scaling
    )

    switch ($scaling) {
        "100%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xCC,0x0C,0x00,0x00,0x00,0x00,0x00,0x80,0x99,0x19,0x00,0x00,0x00,0x00,0x00,0x40,0x66,0x26,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x33,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00))
        }
        "125%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00))
        }
        "150%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x33,0x13,0x00,0x00,0x00,0x00,0x00,0x60,0x66,0x26,0x00,0x00,0x00,0x00,0x00,0x90,0x99,0x39,0x00,0x00,0x00,0x00,0x00,0xC0,0xCC,0x4C,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00)) 
        }
        "175%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x66,0x16,0x00,0x00,0x00,0x00,0x00,0xC0,0xCC,0x2C,0x00,0x00,0x00,0x00,0x00,0x20,0x33,0x43,0x00,0x00,0x00,0x00,0x00,0x80,0x99,0x59,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00))
        }
        "200%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x90,0x99,0x19,0x00,0x00,0x00,0x00,0x00,0x20,0x33,0x33,0x00,0x00,0x00,0x00,0x00,0xB0,0xCC,0x4C,0x00,0x00,0x00,0x00,0x00,0x40,0x66,0x66,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00))
        }
        "225%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xCC,0x1C,0x00,0x00,0x00,0x00,0x00,0x80,0x99,0x39,0x00,0x00,0x00,0x00,0x00,0x40,0x66,0x56,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x73,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00))
        }
        "250%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00))
        }
        "300%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x66,0x26,0x00,0x00,0x00,0x00,0x00,0xC0,0xCC,0x4C,0x00,0x00,0x00,0x00,0x00,0x20,0x33,0x73,0x00,0x00,0x00,0x00,0x00,0x80,0x99,0x99,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00)) 
        }
        "350%" {Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseXCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xCC,0x2C,0x00,0x00,0x00,0x00,0x00,0x80,0x99,0x59,0x00,0x00,0x00,0x00,0x00,0x40,0x66,0x86,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0xB3,0x00,0x00,0x00,0x00,0x00))
                Set-ItemProperty -Path "HKCU:\Control Panel\Mouse" -Name "SmoothMouseYCurve" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x00,0x00,0x00))
        }
    }

        # Message de confirmation avec DPI spécifique
        Write-Host "The screens have been configured with the DPI $scaling." -ForegroundColor Green
		# Pause de 3 secondes
        Start-Sleep -Seconds 3
}

function Auto-SetScaling {

    $monitors = [System.Windows.Forms.Screen]::AllScreens
    foreach ($monitor in $monitors) {
        $deviceName = $monitor.DeviceName
        $bounds = $monitor.Bounds
        $scaling = [math]::Round(($bounds.Width / $monitor.WorkingArea.Width) * 100)
        Write-Host "Monitor: $deviceName, Scaling: $scaling%"

        # Configurer le DPI scaling en fonction du scaling actuel
        switch ($scaling) {
            100 { Set-Scaling "100%" }
            125 { Set-Scaling "125%" }
            150 { Set-Scaling "150%" }
            175 { Set-Scaling "175%" }
            200 { Set-Scaling "200%" }
            225 { Set-Scaling "225%" }
            250 { Set-Scaling "250%" }
            300 { Set-Scaling "300%" }
            350 { Set-Scaling "350%" }
            default { Write-Host "Scaling not supported: $scaling%" }
        }

        # Message de confirmation avec DPI spécifique
        Write-Host "DPI scaling is detected and automatically configured." -ForegroundColor Green
		# Pause de 3 secondes
        Start-Sleep -Seconds 3
		Show-Menu
    }
}
Show-Menu










